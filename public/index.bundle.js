(()=>{"use strict";var e={d:(t,l)=>{for(var i in l)e.o(l,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:l[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{g:()=>a});class t{static createArray(e){var l;let i=Number(e.startId.charAt(0)),r=Number(e.startId.charAt(e.startId.length-1)),s=Number(e.metaId.charAt(0)),o=Number(e.metaId.charAt(e.metaId.length-1)),a=[];for(let e=0;e<9;e++){let t=[];for(let a=0;a<9;a++)e==i&&a==r?t.push(["s"]):e==s&&a==o?t.push(["m"]):(null===(l=document.getElementById(`${e}${a}`))||void 0===l?void 0:l.hasChildNodes())?t.push(["x"]):t.push(["0"]);a.push(t)}return t.ShortPath(a)}static ShortPath(e){let t,l,i=[],r=[{x:0,y:1},{x:0,y:-1},{x:1,y:0},{x:-1,y:0}];for(let t=0;t<e.length;t++){let t=[];for(let l=0;l<e.length;l++)t.push([""]);i.push(t)}let s=[],o=!1;if(e.forEach(((t,l)=>{t.forEach(((t,i)=>{"m"==t[0]&&r.forEach((t=>{try{let r=e[l+t.y][i+t.x][0];"s"!=r&&"0"!=r||(o=!0)}catch(e){}}))}))})),0==o)return[];e.forEach(((e,r)=>{e.forEach(((e,o)=>{"s"==e[0]&&(s.push({startX:o,startY:r}),l=r,t=o,i[r][o][0]+=`${r}_${o},`)}))}));let a=!1,n=!0,d=0;for(;1==n;){d>0&&e.forEach(((e,t)=>{e.forEach(((e,l)=>{e[0]==String(d)&&s.push({startX:l,startY:t})}))}));let o=0;s.forEach((s=>{let a=0;r.forEach((r=>{try{let o,c=e[s.startY+r.y][s.startX+r.x][0];"x"==c&&(a+=1),o=1==d?`${l}_${t},`:i[s.startY][s.startX][0],"0"==c&&(e[s.startY+r.y][s.startX+r.x][0]=`${d+1}`,i[s.startY+r.y][s.startX+r.x][0]=o+`${s.startY}_${s.startX},`),"m"==c&&(i[s.startY+r.y][s.startX+r.x][0]=o+`${s.startY}_${s.startX},`,n=!1)}catch(e){a+=1}})),a==r.length&&(o+=1)})),o==s.length&&(n=!1,a=!0),s=[],d+=1}if(a)return[];let c=[];return e.forEach(((e,t)=>{e.forEach(((e,l)=>{"m"==e[0]&&(i[t][l][0].split(",").forEach((e=>{let t=e.split("_"),l={y:t[0],x:t[1]};c.push(l)})),c.pop(),c.push({y:t,x:l}))}))})),c}}class l{constructor(e){this.createBall=()=>{let e=document.createElement("div");e.className="ball",e.id=this.color,e.style.backgroundColor=this.color,e.addEventListener("click",(()=>{this.selectBall({object:e})})),this.parentDiv.appendChild(e)},this.selectBall=e=>{if("selectedBall"==e.object.className){e.object.className="ball";for(let e in o.fieldsObj)o.fieldsObj[e].isEmpty?(o.fieldsObj[e].removeHoverListener(),o.fieldsObj[e].changeColor("white")):o.fieldsObj[e].removeBallListener(),o.fieldsObj[e].removeClickListener()}else if("ball"==e.object.className){let t=!0,l=[{x:0,y:1},{x:0,y:-1},{x:1,y:0},{x:-1,y:0}],i=e.object.parentNode;const r=document.getElementsByClassName("selectedBall");for(let e of r)e.className="ball";if(e.object.className="selectedBall",l.forEach((e=>{try{o.fieldsObj[`${Number(i.id.charAt(0))+e.y}${Number(i.id.charAt(i.id.length-1))+e.x}`].isEmpty&&(t=!1)}catch(e){}})),t)return;for(let e in o.fieldsObj)o.fieldsObj[e].isEmpty?o.fieldsObj[e].addHoverListener():o.fieldsObj[e].addBallListener(),o.fieldsObj[e].removeClickListener()}},this.color=e.color,this.parentDiv=e.parentDiv,this.createBall()}}class i{constructor(){this.optionsArr=[{down:{x:-1,y:1},up:{x:1,y:-1}},{down:{x:1,y:1},up:{x:-1,y:-1}},{down:{x:0,y:1},up:{x:0,y:-1}},{up:{x:-1,y:0},down:{x:1,y:0}}]}markFieldsToSmash(){var e,t,l;let i=[],r=[];for(let s in o.fieldsObj)if(!o.fieldsObj[s].isEmpty&&!o.fieldsObj[s].toSmash){let a=null===(e=o.fieldsObj[s].fieldObject.firstElementChild)||void 0===e?void 0:e.id;for(let e of this.optionsArr){let n=1,d=1,c=!0,h="up";for(;c;){let r=`${Number(s.charAt(0))+n*e[h].y}${Number(s.charAt(1))+n*e[h].x}`,f=o.fieldsObj[r];null!=f?(null===(t=f.fieldObject.firstElementChild)||void 0===t?void 0:t.id)==a?(-1==i.indexOf(r)&&(i.push(r),f.toSmash=!0,d+=1),n+=1):(null===(l=f.fieldObject.firstElementChild)||void 0===l?void 0:l.id)!=a&&"up"==h?(h="down",n=1):c=!1:null==f&&"up"==h?(h="down",n=1):null==f&&"down"==h&&(c=!1)}d>=5?(o.fieldsObj[s].toSmash=!0,i.push(s),i.forEach((e=>{r.push(e)}))):(i=[],i.forEach((e=>{o.fieldsObj[e].toSmash=!1})))}}r=[...new Set(r)],r.forEach((e=>{o.fieldsObj[e].deleteBall()}));let s=document.getElementById("pointsText"),a=Number(s.innerHTML)+r.length;s.innerHTML=String(a);for(let e in o.fieldsObj)o.fieldsObj[e].toSmash=!1;return r.length}}var r=function(e,t,l,i){return new(l||(l=Promise))((function(r,s){function o(e){try{n(i.next(e))}catch(e){s(e)}}function a(e){try{n(i.throw(e))}catch(e){s(e)}}function n(e){var t;e.done?r(e.value):(t=e.value,t instanceof l?t:new l((function(e){e(t)}))).then(o,a)}n((i=i.apply(e,t||[])).next())}))};class s{constructor(e){this.isEmpty=!0,this.toSmash=!1,this.shortPath=[],this.clickListener=()=>r(this,void 0,void 0,(function*(){var e;let t="",l="";const r=document.getElementsByClassName("selectedBall");for(let i of r)t=null===(e=i.parentElement)||void 0===e?void 0:e.id,l=i.id;o.fieldsObj[t].deleteBall();for(let e in o.fieldsObj)o.fieldsObj[e].isEmpty?(o.fieldsObj[e].removeHoverListener(),o.fieldsObj[e].changeColor("white")):o.fieldsObj[e].removeBallListener(),o.fieldsObj[e].removeClickListener();o.fieldsObj[this.fieldId].addBall(l),yield this.stopTime(),0==(new i).markFieldsToSmash()&&a.NewGameBoard.drawPlacesForBalls()})),this.stopTime=()=>r(this,void 0,void 0,(function*(){this.shortPath.forEach((e=>{document.getElementById(`${e.y}${e.x}`).style.backgroundColor="lightgray"})),document.getElementById("gameBoardMainDiv").style.pointerEvents="none",yield new Promise((e=>setTimeout(e,700))),this.shortPath.forEach((e=>{document.getElementById(`${e.y}${e.x}`).style.backgroundColor="white"})),document.getElementById("gameBoardMainDiv").style.pointerEvents="auto"})),this.ballListener=()=>{for(let e in o.fieldsObj)o.fieldsObj[e].changeColor("white")},this.hoverListener=()=>{var e;for(let e in o.fieldsObj)o.fieldsObj[e].changeColor("white");let l="",i=this.fieldId;const r=document.getElementsByClassName("selectedBall");for(let t of r)l=null===(e=t.parentElement)||void 0===e?void 0:e.id;let s=t.createArray({startId:l,metaId:i});this.shortPath=s,s.forEach((e=>{document.getElementById(`${e.y}${e.x}`).style.backgroundColor="red",document.getElementById(`${e.y}${e.x}`).style.cursor="pointer"})),s.length>0&&this.addClickListener()},this.row=e.row,this.fieldId=e.fieldId,this.createField()}addBall(e,t){new l({color:e,parentDiv:this.fieldObject}),this.isEmpty=!1}deleteBall(){for(var e;null===(e=this.fieldObject)||void 0===e?void 0:e.firstChild;)this.fieldObject.removeChild(this.fieldObject.firstChild);this.isEmpty=!0}createField(){let e=document.createElement("div");e.id=this.fieldId,e.className="field",this.fieldObject=e,this.row.appendChild(e)}addHoverListener(){var e;null===(e=this.fieldObject)||void 0===e||e.addEventListener("mouseenter",this.hoverListener)}removeHoverListener(){var e;null===(e=this.fieldObject)||void 0===e||e.removeEventListener("mouseenter",this.hoverListener)}addBallListener(){var e;null===(e=this.fieldObject)||void 0===e||e.addEventListener("mouseenter",this.ballListener)}removeBallListener(){var e;null===(e=this.fieldObject)||void 0===e||e.removeEventListener("mouseenter",this.ballListener)}addClickListener(){var e;null===(e=this.fieldObject)||void 0===e||e.addEventListener("click",this.clickListener)}removeClickListener(){var e;this.fieldObject.style.cursor="auto",null===(e=this.fieldObject)||void 0===e||e.removeEventListener("click",this.clickListener)}changeColor(e){this.fieldObject.style.backgroundColor=e}}class o{constructor(){this.colorsArr=["blue","red","orange","green","yellow","pink","gray"],this.threeColors=[],this.create()}addBallsToPreview(){return e=this,t=void 0,i=function*(){let e=document.getElementById("ballsPreviewDiv"),t=0,l=0;for(;e.firstChild;)e.removeChild(e.firstChild);for(let e in o.fieldsObj)o.fieldsObj[e].isEmpty&&(t+=1);if(0==t){yield new Promise((e=>setTimeout(e,200)));let e=document.getElementById("pointsText").innerHTML;alert(`Koniec gry! TwÃ³j wynik to ${e} pkt! Gratulacje :)`),document.getElementById("gameBoardMainDiv").style.pointerEvents="none"}else{t>=3?l=3:t>0&&t<3&&(l=t);for(let e=0;e<l;e++)this.threeColors.push(this.colorsArr[Math.floor(Math.random()*this.colorsArr.length)])}this.threeColors.forEach((t=>{let l=document.createElement("div");l.className="ballInPrev",l.style.backgroundColor=t,e.appendChild(l)}))},new((l=void 0)||(l=Promise))((function(r,s){function o(e){try{n(i.next(e))}catch(e){s(e)}}function a(e){try{n(i.throw(e))}catch(e){s(e)}}function n(e){var t;e.done?r(e.value):(t=e.value,t instanceof l?t:new l((function(e){e(t)}))).then(o,a)}n((i=i.apply(e,t||[])).next())}));var e,t,l,i}drawPlacesForBalls(){this.threeColors.forEach((e=>{let t=!0,l=0,i=0;for(;t;)l=Math.floor(9*Math.random()),i=Math.floor(9*Math.random()),1==o.fieldsObj[`${l}${i}`].isEmpty?t=!1:console.log("again");o.fieldsObj[`${l}${i}`].addBall(e)})),(new i).markFieldsToSmash(),this.threeColors=[],this.addBallsToPreview()}create(){let e=document.getElementById("gameBoardMainDiv");for(let t=0;t<9;t++){let l=document.createElement("div");l.id=`row_${t}`,l.className="boardRow";for(let e=0;e<9;e++){let i=new s({row:l,fieldId:`${t}${e}`});o.fieldsObj[`${t}${e}`]=i}e.appendChild(l)}this.addBallsToPreview(),this.drawPlacesForBalls()}}o.fieldsObj={};class a{}a.NewGameBoard=new o})();